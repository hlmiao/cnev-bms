# 预测分析算法说明文档

## 概述
本文档详细说明L7预测分析模块中各个预测指标所使用的算法和计算方法。当前实现为Mock预测服务，采用基于规则的统计算法，适用于POC演示。

---

## 1. 容量预测算法

### 1.1 输入参数
- **当前容量保持率** (`currentCapacity`): 当前电池容量占额定容量的百分比
- **历史衰减率** (`degradationRate`): 年均容量衰减率 (%/年)
- **预测时长**: 12个月

### 1.2 算法原理
采用**线性外推法 + 随机波动**模拟容量衰减趋势

#### 核心公式
```
月均衰减率 = 年均衰减率 / 12

预测容量(第N月) = 当前容量 - (月均衰减率 × N × 随机因子)

随机因子 = 0.95 ~ 1.05 (模拟实际波动)

预测下界 = 预测值 - 不确定性
预测上界 = 预测值 + 不确定性

不确定性 = (12 - N) × 0.3  (时间越长，不确定性越大)
```

#### 置信度计算
```
置信度(第N月) = max(60, 95 - N × 2)
```
- 第1个月: 95%置信度
- 第6个月: 83%置信度
- 第12个月: 71%置信度

#### 阈值预警
```
if 预测容量 < 80%:
    记录达到阈值的月份
    计算剩余可用月数
```

### 1.3 算法特点
- **线性趋势**: 假设容量衰减呈线性趋势
- **随机波动**: 添加5%的随机波动模拟真实情况
- **置信区间**: 提供预测上下界，反映不确定性
- **动态置信度**: 近期预测置信度高，远期预测置信度低

### 1.4 实际应用建议
真实生产环境建议使用：
- **ARIMA模型**: 适合时序数据预测
- **指数平滑法**: 考虑近期数据权重
- **机器学习模型**: LSTM、GRU等深度学习模型

---

## 2. SOH预测算法

### 2.1 输入参数
- **当前SOH** (`currentSOH`): 当前电池健康度 (%)
- **月均衰减率**: 0.3 ~ 0.7 %/月（随机生成）
- **预测时长**: 12个月

### 2.2 算法原理
采用**固定衰减率 + 随机波动**模拟SOH下降趋势

#### 核心公式
```
月均衰减率 = 0.3 + random(0, 0.4)  // 0.3~0.7%/月

预测SOH(第N月) = 当前SOH - (月均衰减率 × N × 随机因子)

随机因子 = 0.95 ~ 1.05

预测下界 = 预测值 - (12 - N) × 0.4
预测上界 = 预测值 + (12 - N) × 0.4
```

#### 剩余寿命估算
```
剩余SOH = 当前SOH - 70  (假设70%为更换阈值)

预计剩余寿命(月) = 剩余SOH / 月均衰减率

建议更换日期 = 当前日期 + 预计剩余寿命
```

#### 置信度计算
```
置信度(第N月) = max(65, 95 - N × 2)
```

### 2.3 算法特点
- **固定衰减**: 假设SOH以固定速率衰减
- **阈值判断**: 70%作为更换阈值
- **寿命估算**: 基于线性外推计算剩余寿命
- **安全边界**: 提供预测区间保证安全性

### 2.4 实际应用建议
真实生产环境建议使用：
- **Arrhenius方程**: 考虑温度对衰减的影响
- **循环次数模型**: 基于充放电循环次数预测
- **多因子模型**: 综合温度、倍率、DOD等因素

---

## 3. 故障风险预测算法

### 3.1 输入参数
- **一致性评分** (`consistencyScore`): 0-100分
- **容量保持率** (`capacityRetention`): 百分比
- **告警数量** (`alertCount`): 当前告警总数
- **严重告警数量** (`criticalAlertCount`): 严重告警数
- **温度差异** (`temperatureDiff`): 最大温度差 (°C)

### 3.2 算法原理
采用**多维度风险评估 + 加权求和**计算综合风险

#### 风险评分计算
```
总风险评分 = Σ(各维度风险 × 权重)

各维度风险计算：

1. 一致性风险 (权重: 0.3)
   if 一致性评分 < 70:
       风险概率 = min(90, 100 - 一致性评分)
       风险评分 = 风险概率 × 0.3

2. 容量衰减风险 (权重: 0.25)
   if 容量保持率 < 85:
       风险概率 = min(85, 100 - 容量保持率)
       风险评分 = 风险概率 × 0.25

3. 告警风险 (权重: 0.25)
   if 告警总数 > 3:
       风险概率 = min(80, 告警数 × 10 + 严重告警数 × 20)
       风险评分 = 风险概率 × 0.25

4. 温度风险 (权重: 0.2)
   if 温度差异 > 10:
       风险概率 = min(70, 温度差异 × 5)
       风险评分 = 风险概率 × 0.2

总风险评分 = min(100, Σ风险评分)
```

#### 风险等级判定
```
if 风险评分 >= 75:  风险等级 = 极高 (critical)
elif 风险评分 >= 50: 风险等级 = 高 (high)
elif 风险评分 >= 30: 风险等级 = 中 (medium)
else:                风险等级 = 低 (low)
```

#### 故障时间预测
```
一致性故障预测时间 = max(1, (一致性评分 - 50) / 5) 月

容量故障预测时间 = max(2, (容量保持率 - 70) / 2) 月

告警故障预测时间 = 严重告警 > 0 ? 1月 : 3月

温度故障预测时间 = 2月
```

### 3.3 算法特点
- **多维度评估**: 综合考虑一致性、容量、告警、温度
- **加权求和**: 不同维度赋予不同权重
- **动态阈值**: 根据实际情况触发风险评估
- **时间预测**: 估算故障可能发生的时间

### 3.4 实际应用建议
真实生产环境建议使用：
- **机器学习分类**: Random Forest、XGBoost等
- **异常检测**: Isolation Forest、One-Class SVM
- **深度学习**: LSTM-Autoencoder用于异常检测
- **专家系统**: 结合领域知识的规则引擎

---

## 4. 成本预测算法

### 4.1 输入参数
- **Bank数量** (`bankCount`): 电池组数量
- **一致性评分** (`consistencyScore`): 影响均衡频率
- **容量保持率** (`capacityRetention`): 影响测试频率
- **告警数量** (`alertCount`): 影响故障处理成本
- **预测时长**: 12个月

### 4.2 算法原理
采用**成本模型 + 事件触发**计算维护成本

#### 基础维护成本
```
月度基础成本 = Bank数量 × 500元/Bank/月

包含：
- 日常巡检
- 数据监控
- 基础维护
```

#### 季度维护成本
```
if 月份 % 3 == 0:
    季度维护成本 = Bank数量 × 1000元/Bank
    
包含：
- 深度检查
- 设备保养
- 系统优化
```

#### 均衡充电成本
```
if 一致性评分 < 80 and 月份 % 2 == 0:
    均衡成本 = Bank数量 × 300元/Bank
    
触发条件：
- 一致性评分低于80分
- 每2个月执行一次
```

#### 容量测试成本
```
if 容量保持率 < 85 and 月份 % 4 == 0:
    测试成本 = Bank数量 × 800元/Bank
    
触发条件：
- 容量保持率低于85%
- 每4个月执行一次
```

#### 故障处理成本
```
if 告警数量 > 0 and 月份 <= 3:
    故障成本 = 严重告警数 × 2000 + 错误告警数 × 1000
    
特点：
- 前3个月处理现有告警
- 严重告警成本更高
```

#### 月度总成本
```
月度总成本 = (基础成本 + 季度成本 + 均衡成本 + 测试成本 + 故障成本) × 随机因子

随机因子 = 0.9 ~ 1.1  (模拟实际波动)
```

#### 更换成本估算
```
单体数量 = Bank数量 × 240个/Bank

单体成本 = 150元/个

更换总成本 = 单体数量 × 单体成本

更换时间 = 容量预测达到80%阈值的时间
```

#### 成本趋势判断
```
前3月平均成本 = Σ(第1-3月成本) / 3
后3月平均成本 = Σ(第10-12月成本) / 3

if 后3月平均 > 前3月平均 × 1.2:
    趋势 = 上升
elif 后3月平均 < 前3月平均 × 0.8:
    趋势 = 下降
else:
    趋势 = 稳定
```

### 4.3 算法特点
- **成本模型**: 基于实际运维经验建立成本模型
- **事件驱动**: 根据设备状态触发不同维护项目
- **动态调整**: 成本随设备状态动态变化
- **趋势分析**: 分析成本变化趋势

### 4.4 实际应用建议
真实生产环境建议使用：
- **历史数据分析**: 基于实际维护记录建模
- **回归分析**: 多元线性回归预测成本
- **时间序列**: ARIMA、Prophet预测成本趋势
- **成本优化**: 运筹学方法优化维护计划

---

## 5. 综合预测报告算法

### 5.1 综合风险评估
```
综合风险 = 基于以下条件判定：

if 故障风险 == 极高 or 容量 < 75 or SOH < 75:
    综合风险 = 极高
elif 故障风险 == 高 or 容量 < 80 or SOH < 80:
    综合风险 = 高
elif 故障风险 == 中 or 容量 < 85 or SOH < 85:
    综合风险 = 中
else:
    综合风险 = 低
```

### 5.2 预测摘要生成
```
摘要内容：
1. 容量状态：当前值 + 预计关注时间
2. SOH状态：当前值 + 剩余寿命
3. 故障风险：风险等级 + 风险评分 + 潜在故障数
4. 成本预测：12个月总成本 + 成本趋势
5. 综合评估：风险等级 + 建议
```

---

## 6. 算法对比：Mock vs 真实模型

### 6.1 当前Mock算法
| 特点 | 说明 |
|------|------|
| 算法类型 | 基于规则的统计算法 |
| 数据需求 | 仅需当前状态数据 |
| 准确性 | 趋势正确，数值为模拟 |
| 适用场景 | POC演示、概念验证 |
| 优点 | 快速实现、无需训练 |
| 缺点 | 不是真实预测 |

### 6.2 真实生产模型建议

#### 容量预测
- **LSTM神经网络**: 学习时序模式
- **Prophet**: Facebook开源时序预测
- **ARIMA**: 经典时序分析
- **数据需求**: 至少6个月历史数据

#### SOH预测
- **物理模型**: Arrhenius方程 + 循环老化
- **数据驱动**: 机器学习回归模型
- **混合模型**: 物理模型 + 数据校正
- **数据需求**: 温度、循环次数、DOD等

#### 故障预测
- **Random Forest**: 分类预测故障类型
- **XGBoost**: 高精度梯度提升
- **Isolation Forest**: 异常检测
- **数据需求**: 大量历史故障数据

#### 成本预测
- **线性回归**: 多因子成本模型
- **时间序列**: 成本趋势预测
- **优化算法**: 维护计划优化
- **数据需求**: 历史维护成本记录

---

## 7. 算法参数配置

### 7.1 可调参数
```typescript
// 容量预测参数
const CAPACITY_PARAMS = {
  predictionMonths: 12,        // 预测月数
  randomFactor: [0.95, 1.05],  // 随机因子范围
  uncertaintyFactor: 0.3,      // 不确定性系数
  confidenceBase: 95,          // 基础置信度
  confidenceDecay: 2,          // 置信度衰减率
  warningThreshold: 80         // 告警阈值
};

// SOH预测参数
const SOH_PARAMS = {
  degradationRateMin: 0.3,     // 最小衰减率 (%/月)
  degradationRateMax: 0.7,     // 最大衰减率 (%/月)
  replacementThreshold: 70,    // 更换阈值 (%)
  uncertaintyFactor: 0.4       // 不确定性系数
};

// 故障风险参数
const RISK_PARAMS = {
  consistencyWeight: 0.3,      // 一致性权重
  capacityWeight: 0.25,        // 容量权重
  alertWeight: 0.25,           // 告警权重
  temperatureWeight: 0.2,      // 温度权重
  criticalThreshold: 75,       // 极高风险阈值
  highThreshold: 50,           // 高风险阈值
  mediumThreshold: 30          // 中风险阈值
};

// 成本预测参数
const COST_PARAMS = {
  baseMaintenanceCost: 500,    // 基础维护成本 (元/Bank/月)
  quarterlyMaintenanceCost: 1000, // 季度维护成本 (元/Bank)
  balanceCost: 300,            // 均衡成本 (元/Bank)
  capacityTestCost: 800,       // 容量测试成本 (元/Bank)
  criticalAlertCost: 2000,     // 严重告警成本 (元)
  errorAlertCost: 1000,        // 错误告警成本 (元)
  cellReplacementCost: 150,    // 单体更换成本 (元/个)
  cellsPerBank: 240            // 每Bank单体数
};
```

### 7.2 参数调优建议
1. **基于历史数据**: 使用实际数据校准参数
2. **A/B测试**: 对比不同参数的预测效果
3. **专家验证**: 请领域专家评估参数合理性
4. **持续优化**: 根据预测准确性持续调整

---

## 8. 算法局限性和改进方向

### 8.1 当前局限性
1. **线性假设**: 假设衰减呈线性，实际可能非线性
2. **独立预测**: 各指标独立预测，未考虑相互影响
3. **缺乏学习**: 无法从历史预测中学习改进
4. **固定参数**: 参数固定，无法自适应调整
5. **简化模型**: 未考虑温度、倍率等复杂因素

### 8.2 改进方向
1. **引入机器学习**: 使用LSTM、GRU等深度学习模型
2. **多变量建模**: 考虑温度、倍率、DOD等多因素
3. **在线学习**: 根据实际数据持续优化模型
4. **集成学习**: 组合多个模型提高准确性
5. **物理约束**: 结合电化学模型提供物理约束

---

## 9. 总结

### 9.1 算法总览
| 预测指标 | 算法类型 | 核心方法 | 准确性 |
|---------|---------|---------|--------|
| 容量预测 | 线性外推 | 固定衰减率 + 随机波动 | 趋势准确 |
| SOH预测 | 线性外推 | 固定衰减率 + 寿命估算 | 趋势准确 |
| 故障预测 | 多维评估 | 加权求和 + 阈值判断 | 风险识别 |
| 成本预测 | 成本模型 | 事件驱动 + 趋势分析 | 合理估算 |

### 9.2 适用场景
- ✅ POC演示和概念验证
- ✅ 客户需求收集
- ✅ 功能价值展示
- ❌ 生产环境精确预测
- ❌ 关键决策依据

### 9.3 生产化建议
要将预测功能用于生产环境，需要：
1. 收集至少6-12个月的历史数据
2. 训练机器学习模型
3. 验证模型准确性（RMSE、MAE等指标）
4. 建立模型更新机制
5. 设置预测置信度阈值
6. 建立人工审核流程

---

**文档版本**: 1.0  
**更新时间**: 2026年2月11日  
**适用模块**: L7 预测分析  
**算法类型**: Mock预测服务（基于规则）
